{% extends "base.html" %}
{% block title %}Choose Template - SendBaba{% endblock %}
{% block content %}
<div class="p-6">
    <div class="mb-8">
        <a href="/dashboard/campaigns/create" class="text-gray-500 hover:text-gray-700 mb-4 inline-flex items-center gap-2">
            <i class="fas fa-arrow-left"></i> Back
        </a>
        <h1 class="text-3xl font-bold text-gray-900 mt-4">Choose a Template</h1>
        <p class="text-gray-600 mt-2">Select a template for: <strong>{{ campaign_name }}</strong></p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Blank Template -->
        <div class="bg-white rounded-xl shadow-sm border-2 border-gray-200 hover:border-green-500 transition cursor-pointer group" onclick="selectTemplate('blank')">
            <div class="aspect-[4/3] bg-gray-50 rounded-t-xl flex items-center justify-center">
                <div class="text-center">
                    <i class="fas fa-plus text-4xl text-gray-400 group-hover:text-green-500 transition"></i>
                    <p class="text-gray-500 mt-2">Start from scratch</p>
                </div>
            </div>
            <div class="p-4">
                <h3 class="font-bold text-gray-900">Blank Template</h3>
                <p class="text-sm text-gray-500">Build your email from scratch</p>
            </div>
        </div>

        <!-- Newsletter Template -->
        <div class="bg-white rounded-xl shadow-sm border-2 border-gray-200 hover:border-green-500 transition cursor-pointer group" onclick="selectTemplate('newsletter')">
            <div class="aspect-[4/3] bg-gradient-to-br from-blue-50 to-indigo-100 rounded-t-xl flex items-center justify-center p-4">
                <div class="bg-white rounded-lg shadow-sm w-full h-full p-3">
                    <div class="h-4 bg-blue-500 rounded mb-2"></div>
                    <div class="h-2 bg-gray-200 rounded w-3/4 mb-1"></div>
                    <div class="h-2 bg-gray-200 rounded w-1/2 mb-3"></div>
                    <div class="h-16 bg-gray-100 rounded mb-2"></div>
                    <div class="h-2 bg-gray-200 rounded mb-1"></div>
                    <div class="h-2 bg-gray-200 rounded w-2/3"></div>
                </div>
            </div>
            <div class="p-4">
                <h3 class="font-bold text-gray-900">Newsletter</h3>
                <p class="text-sm text-gray-500">Classic newsletter layout</p>
            </div>
        </div>

        <!-- Promotional Template -->
        <div class="bg-white rounded-xl shadow-sm border-2 border-gray-200 hover:border-green-500 transition cursor-pointer group" onclick="selectTemplate('promotional')">
            <div class="aspect-[4/3] bg-gradient-to-br from-orange-50 to-red-100 rounded-t-xl flex items-center justify-center p-4">
                <div class="bg-white rounded-lg shadow-sm w-full h-full p-3">
                    <div class="h-20 bg-gradient-to-r from-orange-400 to-red-400 rounded mb-2 flex items-center justify-center">
                        <span class="text-white font-bold text-sm">50% OFF</span>
                    </div>
                    <div class="h-2 bg-gray-200 rounded w-3/4 mx-auto mb-1"></div>
                    <div class="h-6 bg-orange-500 rounded w-1/2 mx-auto mt-2"></div>
                </div>
            </div>
            <div class="p-4">
                <h3 class="font-bold text-gray-900">Promotional</h3>
                <p class="text-sm text-gray-500">Sales and offers</p>
            </div>
        </div>

        <!-- Welcome Template -->
        <div class="bg-white rounded-xl shadow-sm border-2 border-gray-200 hover:border-green-500 transition cursor-pointer group" onclick="selectTemplate('welcome')">
            <div class="aspect-[4/3] bg-gradient-to-br from-green-50 to-emerald-100 rounded-t-xl flex items-center justify-center p-4">
                <div class="bg-white rounded-lg shadow-sm w-full h-full p-3 text-center">
                    <div class="text-2xl mb-2">ðŸ‘‹</div>
                    <div class="h-3 bg-green-500 rounded w-2/3 mx-auto mb-2"></div>
                    <div class="h-2 bg-gray-200 rounded w-3/4 mx-auto mb-1"></div>
                    <div class="h-2 bg-gray-200 rounded w-1/2 mx-auto"></div>
                </div>
            </div>
            <div class="p-4">
                <h3 class="font-bold text-gray-900">Welcome Email</h3>
                <p class="text-sm text-gray-500">Onboard new subscribers</p>
            </div>
        </div>

        <!-- Announcement Template -->
        <div class="bg-white rounded-xl shadow-sm border-2 border-gray-200 hover:border-green-500 transition cursor-pointer group" onclick="selectTemplate('announcement')">
            <div class="aspect-[4/3] bg-gradient-to-br from-purple-50 to-violet-100 rounded-t-xl flex items-center justify-center p-4">
                <div class="bg-white rounded-lg shadow-sm w-full h-full p-3 text-center">
                    <div class="text-2xl mb-2">ðŸ“¢</div>
                    <div class="h-3 bg-purple-500 rounded w-3/4 mx-auto mb-2"></div>
                    <div class="h-2 bg-gray-200 rounded w-full mb-1"></div>
                    <div class="h-2 bg-gray-200 rounded w-2/3 mx-auto"></div>
                </div>
            </div>
            <div class="p-4">
                <h3 class="font-bold text-gray-900">Announcement</h3>
                <p class="text-sm text-gray-500">Share important news</p>
            </div>
        </div>

        <!-- Simple Template -->
        <div class="bg-white rounded-xl shadow-sm border-2 border-gray-200 hover:border-green-500 transition cursor-pointer group" onclick="selectTemplate('simple')">
            <div class="aspect-[4/3] bg-gradient-to-br from-gray-50 to-slate-100 rounded-t-xl flex items-center justify-center p-4">
                <div class="bg-white rounded-lg shadow-sm w-full h-full p-3">
                    <div class="h-2 bg-gray-300 rounded w-1/4 mb-3"></div>
                    <div class="h-2 bg-gray-200 rounded mb-1"></div>
                    <div class="h-2 bg-gray-200 rounded mb-1"></div>
                    <div class="h-2 bg-gray-200 rounded w-3/4 mb-3"></div>
                    <div class="h-6 bg-gray-800 rounded w-1/3"></div>
                </div>
            </div>
            <div class="p-4">
                <h3 class="font-bold text-gray-900">Simple Text</h3>
                <p class="text-sm text-gray-500">Clean, minimal design</p>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div id="loadingModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
    <div class="bg-white rounded-xl p-8 text-center">
        <i class="fas fa-spinner fa-spin text-4xl text-green-500 mb-4"></i>
        <p class="text-lg font-semibold">Creating your campaign...</p>
    </div>
</div>

<script>
const campaignName = "{{ campaign_name }}";

const templateHtml = {
    blank: '',
    newsletter: `
        <div style="padding: 40px 20px; background: #f8fafc;">
            <div style="max-width: 600px; margin: 0 auto; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div style="background: #3b82f6; padding: 30px; text-align: center;">
                    <h1 style="color: white; margin: 0; font-size: 28px;">Your Newsletter</h1>
                </div>
                <div style="padding: 30px;">
                    <h2 style="color: #1e293b; font-size: 22px; margin-bottom: 15px;">Hello {{first_name}},</h2>
                    <p style="color: #475569; line-height: 1.6; margin-bottom: 20px;">Welcome to our newsletter! We're excited to share the latest updates with you.</p>
                    <div style="background: #f1f5f9; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="color: #1e293b; margin-bottom: 10px;">Featured Article</h3>
                        <p style="color: #64748b; margin-bottom: 15px;">Click below to read our latest article and stay informed.</p>
                        <a href="#" style="display: inline-block; background: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold;">Read More</a>
                    </div>
                </div>
                <div style="background: #f8fafc; padding: 20px; text-align: center; border-top: 1px solid #e2e8f0;">
                    <p style="color: #94a3b8; font-size: 14px; margin: 0;">Â© 2025 Your Company. All rights reserved.</p>
                </div>
            </div>
        </div>
    `,
    promotional: `
        <div style="padding: 40px 20px; background: #fff7ed;">
            <div style="max-width: 600px; margin: 0 auto; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div style="background: linear-gradient(135deg, #f97316, #ef4444); padding: 40px; text-align: center;">
                    <h1 style="color: white; margin: 0; font-size: 42px; font-weight: bold;">50% OFF</h1>
                    <p style="color: rgba(255,255,255,0.9); font-size: 18px; margin-top: 10px;">Limited Time Offer!</p>
                </div>
                <div style="padding: 30px; text-align: center;">
                    <h2 style="color: #1e293b; font-size: 24px; margin-bottom: 15px;">Hey {{first_name}}!</h2>
                    <p style="color: #475569; line-height: 1.6; margin-bottom: 25px;">Don't miss out on our biggest sale of the year. Use code <strong>SAVE50</strong> at checkout.</p>
                    <a href="#" style="display: inline-block; background: #f97316; color: white; padding: 16px 40px; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 18px;">Shop Now</a>
                    <p style="color: #94a3b8; font-size: 14px; margin-top: 20px;">Offer expires in 48 hours</p>
                </div>
            </div>
        </div>
    `,
    welcome: `
        <div style="padding: 40px 20px; background: #f0fdf4;">
            <div style="max-width: 600px; margin: 0 auto; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div style="padding: 40px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 20px;">ðŸ‘‹</div>
                    <h1 style="color: #1e293b; font-size: 28px; margin-bottom: 15px;">Welcome, {{first_name}}!</h1>
                    <p style="color: #475569; line-height: 1.6; margin-bottom: 25px;">We're thrilled to have you join our community. Here's what you can expect from us.</p>
                    <div style="background: #f0fdf4; padding: 20px; border-radius: 8px; margin-bottom: 25px; text-align: left;">
                        <p style="color: #166534; margin: 0 0 10px 0;">âœ“ Weekly updates and tips</p>
                        <p style="color: #166534; margin: 0 0 10px 0;">âœ“ Exclusive member offers</p>
                        <p style="color: #166534; margin: 0;">âœ“ Early access to new features</p>
                    </div>
                    <a href="#" style="display: inline-block; background: #22c55e; color: white; padding: 14px 32px; text-decoration: none; border-radius: 8px; font-weight: bold;">Get Started</a>
                </div>
            </div>
        </div>
    `,
    announcement: `
        <div style="padding: 40px 20px; background: #faf5ff;">
            <div style="max-width: 600px; margin: 0 auto; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <div style="background: #8b5cf6; padding: 30px; text-align: center;">
                    <div style="font-size: 36px; margin-bottom: 10px;">ðŸ“¢</div>
                    <h1 style="color: white; margin: 0; font-size: 26px;">Big Announcement!</h1>
                </div>
                <div style="padding: 30px;">
                    <p style="color: #475569; line-height: 1.6; margin-bottom: 20px;">Hi {{first_name}},</p>
                    <p style="color: #475569; line-height: 1.6; margin-bottom: 20px;">We have some exciting news to share with you! We've been working hard on something special and can't wait for you to see it.</p>
                    <div style="background: #f5f3ff; padding: 20px; border-radius: 8px; border-left: 4px solid #8b5cf6; margin-bottom: 25px;">
                        <p style="color: #5b21b6; margin: 0; font-weight: 500;">Mark your calendar for the big reveal!</p>
                    </div>
                    <a href="#" style="display: inline-block; background: #8b5cf6; color: white; padding: 14px 32px; text-decoration: none; border-radius: 8px; font-weight: bold;">Learn More</a>
                </div>
            </div>
        </div>
    `,
    simple: `
        <div style="padding: 40px 20px;">
            <div style="max-width: 600px; margin: 0 auto;">
                <p style="color: #1e293b; font-size: 16px; line-height: 1.8; margin-bottom: 20px;">Hi {{first_name}},</p>
                <p style="color: #475569; font-size: 16px; line-height: 1.8; margin-bottom: 20px;">I wanted to reach out personally to share some thoughts with you.</p>
                <p style="color: #475569; font-size: 16px; line-height: 1.8; margin-bottom: 20px;">Your content goes here. Keep it simple, clear, and focused on your message.</p>
                <p style="color: #475569; font-size: 16px; line-height: 1.8; margin-bottom: 30px;">Best regards,<br>Your Name</p>
                <a href="#" style="display: inline-block; background: #1e293b; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: 500;">Take Action</a>
            </div>
        </div>
    `
};

function selectTemplate(templateId) {
    document.getElementById('loadingModal').classList.remove('hidden');
    
    // Create campaign via API
    fetch('/dashboard/campaigns/api/create', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            name: campaignName,
            template_id: templateId
        })
    })
    .then(r => r.json())
    .then(data => {
        if (data.success && data.campaign_id) {
            // Save template HTML
            const html = templateHtml[templateId] || '';
            
            return fetch('/dashboard/campaigns/api/save-draft', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    campaign_id: data.campaign_id,
                    name: campaignName,
                    html: html,
                    subject: '',
                    from_name: '',
                    from_email: '',
                    reply_to: '',
                    preview_text: ''
                })
            }).then(r => r.json()).then(() => {
                // Redirect to design page
                window.location.href = '/dashboard/campaigns/design/' + data.campaign_id;
            });
        } else {
            throw new Error(data.error || 'Failed to create campaign');
        }
    })
    .catch(err => {
        document.getElementById('loadingModal').classList.add('hidden');
        alert('Error: ' + err.message);
        console.error(err);
    });
}
</script>
{% endblock %}
