<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SendBaba{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        orange: { 500: '#F97316', 600: '#F7601F', 700: '#EA580C' }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: #F9FAFB; }
        .sidebar { width: 260px; background: #FAFAFA; border-right: 1px solid #E5E7EB; height: 100vh; position: fixed; left: 0; top: 0; display: flex; flex-direction: column; z-index: 50; }
        .sidebar-nav { flex: 1; overflow-y: auto; padding: 0 12px; }
        .sidebar-group { margin-bottom: 24px; }
        .sidebar-group-title { font-size: 11px; font-weight: 600; color: #9CA3AF; text-transform: uppercase; letter-spacing: 0.5px; padding: 8px 12px; }
        .sidebar-link { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; color: #4B5563; font-size: 14px; font-weight: 500; transition: all 0.15s; text-decoration: none; }
        .sidebar-link:hover { background: #F3F4F6; color: #111827; }
        .sidebar-link.active { background: #FFF7ED; color: #EA580C; }
        .sidebar-link i { width: 20px; text-align: center; font-size: 16px; }
        .badge-new { background: #10B981; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; font-weight: 600; }
        .main-content { margin-left: 260px; min-height: 100vh; }
        .top-bar { background: white; border-bottom: 1px solid #E5E7EB; padding: 16px 32px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 40; }
        .page-content { padding: 32px; }
        .upgrade-card { display: block; margin: 12px; padding: 16px; background: linear-gradient(135deg, #F97316, #EA580C); border-radius: 12px; color: white; text-decoration: none; }
        .upgrade-card h3 { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
        .upgrade-card p { font-size: 12px; opacity: 0.9; margin-bottom: 8px; }
        .user-profile { display: flex; align-items: center; gap: 12px; padding: 12px; margin: 12px; border-radius: 8px; cursor: pointer; }
        .user-profile:hover { background: #F3F4F6; }
        .user-avatar { width: 36px; height: 36px; background: linear-gradient(135deg, #F97316, #EA580C); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; }
        .user-info { flex: 1; }
        .user-name { font-size: 14px; font-weight: 600; color: #111827; }
        .user-plan { font-size: 12px; color: #6B7280; }
        .user-menu { display: none; position: absolute; bottom: 70px; left: 12px; right: 12px; background: white; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); padding: 8px; }
        .user-menu.show { display: block; }
        .user-menu a { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 6px; color: #4B5563; font-size: 14px; text-decoration: none; }
        .user-menu a:hover { background: #F3F4F6; }
        .user-menu a.logout { color: #EF4444; }
        .btn-primary { background: linear-gradient(135deg, #F97316, #EA580C); color: white; padding: 10px 20px; border-radius: 8px; font-weight: 600; font-size: 14px; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; }
        .btn-primary:hover { box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4); }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .mobile-menu-btn { display: flex !important; }
        }
        .mobile-menu-btn { display: none; position: fixed; top: 16px; left: 16px; z-index: 60; width: 40px; height: 40px; background: white; border: 1px solid #E5E7EB; border-radius: 8px; align-items: center; justify-content: center; cursor: pointer; }
        .sidebar-footer { border-top: 1px solid #E5E7EB; position: relative; }
        /* Feature link transition for smooth show/hide */
        .feature-link { transition: all 0.3s ease; overflow: hidden; max-height: 50px; opacity: 1; }
        .feature-link.hidden { max-height: 0; opacity: 0; padding: 0 12px; margin: 0; pointer-events: none; }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <button class="mobile-menu-btn" onclick="document.getElementById('sidebar').classList.toggle('open')">
        <i class="fas fa-bars"></i>
    </button>

    <aside class="sidebar" id="sidebar">
        <div style="padding: 20px 16px; border-bottom: 1px solid #E5E7EB;">
            <a href="/dashboard" style="display: flex; align-items: center; gap: 10px; text-decoration: none;">
                <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #F97316, #EA580C); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-paper-plane text-white"></i>
                </div>
                <span style="font-size: 20px; font-weight: 700; color: #111827;">SendBaba</span>
            </a>
        </div>
        
        <nav class="sidebar-nav">
            <!-- CORE Section - Always visible -->
            <div class="sidebar-group">
                <div class="sidebar-group-title">Core</div>
                <a href="/dashboard" class="sidebar-link {% if request.path == '/dashboard' or request.path == '/dashboard/' %}active{% endif %}">
                    <i class="fas fa-home"></i><span>Dashboard</span>
                </a>
                <a href="/dashboard/campaigns" class="sidebar-link {% if '/campaigns' in request.path %}active{% endif %}">
                    <i class="fas fa-paper-plane"></i><span>Campaigns</span>
                </a>
                <a href="/dashboard/contacts" class="sidebar-link {% if '/contacts' in request.path %}active{% endif %}">
                    <i class="fas fa-users"></i><span>Contacts</span>
                </a>
                <a href="/dashboard/analytics" class="sidebar-link {% if '/analytics' in request.path %}active{% endif %}">
                    <i class="fas fa-chart-line"></i><span>Analytics</span>
                </a>
            </div>
            
            <!-- AUTOMATION Section -->
            <div class="sidebar-group" id="automationGroup">
                <div class="sidebar-group-title">Automation</div>
                
                <a href="/dashboard/workflows" class="sidebar-link feature-link {% if '/workflows' in request.path %}active{% endif %}" data-feature="workflows">
                    <i class="fas fa-project-diagram"></i><span>Workflows</span>
                    
                </a>
                
                <a href="/dashboard/forms" class="sidebar-link {% if '/forms' in request.path %}active{% endif %}">
                    <i class="fas fa-clipboard-list"></i><span>Forms</span>
                    
                </a>
                
                <a href="/dashboard/segments" class="sidebar-link feature-link {% if '/segments' in request.path %}active{% endif %}" data-feature="segments">
                    <i class="fas fa-filter"></i><span>Segments</span>
                    
                </a>
                
                <a href="/dashboard/integrations" class="sidebar-link {% if '/integrations' in request.path %}active{% endif %}">
                    <i class="fas fa-plug"></i><span>Integrations</span>
                </a>
            </div>
            
            <!-- TOOLS Section -->
            <div class="sidebar-group">
                <div class="sidebar-group-title">Tools</div>
                <a href="/dashboard/email-builder" class="sidebar-link {% if '/email-builder' in request.path %}active{% endif %}">
                    <i class="fas fa-palette"></i><span>Email Builder</span>
                    
                </a>
                
                <a href="/dashboard/replies" class="sidebar-link feature-link {% if '/replies' in request.path %}active{% endif %}" data-feature="ai_reply">
                    <i class="fas fa-robot"></i><span>Reply AI</span>
                    
                </a>
            </div>
            
            <!-- SETTINGS Section -->
            <div class="sidebar-group">
                <div class="sidebar-group-title">Settings</div>
                <a href="/dashboard/domains" class="sidebar-link {% if '/domains' in request.path %}active{% endif %}">
                    <i class="fas fa-globe"></i><span>Domains</span>
                </a>
                
                <a href="/dashboard/team" class="sidebar-link feature-link {% if '/team' in request.path %}active{% endif %}" data-feature="team">
                    <i class="fas fa-user-friends"></i><span>Team</span>
                </a>
                
                <a href="/dashboard/billing" class="sidebar-link {% if '/billing' in request.path %}active{% endif %}">
                    <i class="fas fa-credit-card"></i><span>Billing</span>
                </a>
                <a href="/dashboard/settings" class="sidebar-link {% if request.path == '/dashboard/settings' or request.path == '/dashboard/settings/' %}active{% endif %}">
                    <i class="fas fa-cog"></i><span>Account</span>
                </a>
            </div>
        </nav>
        
        <div class="sidebar-footer">
            <a href="/dashboard/billing/plans" class="upgrade-card">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                    <i class="fas fa-crown"></i>
                    <h3>Upgrade to Pro</h3>
                </div>
                <p>Unlimited emails & features</p>
                <div style="display: flex; align-items: center; justify-content: space-between; font-size: 13px; font-weight: 600;">
                    <span>View Plans</span>
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>
            
            <div class="user-profile" onclick="document.getElementById('userMenu').classList.toggle('show')">
                <div class="user-avatar">{{ current_user.email[0].upper() if current_user and current_user.email else 'U' }}</div>
                <div class="user-info">
                    <div class="user-name">{{ current_user.email.split('@')[0] if current_user and current_user.email else 'User' }}</div>
                    <div class="user-plan">{{ subscription.plan_name if subscription else 'Free Plan' }}</div>
                </div>
                <i class="fas fa-chevron-down" style="color: #9CA3AF; font-size: 12px;"></i>
            </div>
            
            <div class="user-menu" id="userMenu">
                <a href="/dashboard/settings"><i class="fas fa-user"></i> Profile</a>
                <a href="/dashboard/billing"><i class="fas fa-credit-card"></i> Billing</a>
                <a href="/logout" class="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
    </aside>
    
    <main class="main-content">
        <header class="top-bar">
            <div>
                <h1 style="font-size: 24px; font-weight: 700; color: #111827;">{% block page_title %}Dashboard{% endblock %}</h1>
                <p style="font-size: 14px; color: #6B7280;">{% block page_subtitle %}{% endblock %}</p>
            </div>
            <div style="display: flex; align-items: center; gap: 16px;">
                <button style="width: 40px; height: 40px; border-radius: 8px; border: 1px solid #E5E7EB; background: white; cursor: pointer; position: relative;">
                    <i class="fas fa-bell" style="color: #6B7280;"></i>
                </button>
                <a href="/dashboard/campaigns/create" class="btn-primary">
                    <i class="fas fa-plus"></i>
                    <span>New Campaign</span>
                </a>
            </div>
        </header>
        
        <div class="page-content">
            {% block content %}{% endblock %}
        </div>
    </main>
    
    <script>
        // User menu toggle
        document.addEventListener('click', function(e) {
            const userMenu = document.getElementById('userMenu');
            const userProfile = document.querySelector('.user-profile');
            if (userMenu && !userProfile.contains(e.target)) {
                userMenu.classList.remove('show');
            }
        });
        
        // Feature visibility management - Real-time sidebar updates
        window.SidebarFeatures = {
            // Current feature states
            features: {
                workflows: {{ 'true' if features.workflows else 'false' }},
                segments: {{ 'true' if features.segments else 'false' }},
                team: {{ 'true' if features.team else 'false' }},
                ai_reply: {{ 'true' if features.ai_reply else 'false' }}
            },
            
            // Update feature visibility
            setFeature: function(feature, enabled) {
                this.features[feature] = enabled;
                this.updateSidebar();
            },
            
            // Toggle feature
            toggleFeature: function(feature) {
                this.features[feature] = !this.features[feature];
                this.updateSidebar();
                return this.features[feature];
            },
            
            // Update sidebar visibility based on features
            updateSidebar: function() {
                document.querySelectorAll('.feature-link').forEach(link => {
                    const feature = link.getAttribute('data-feature');
                    if (feature && this.features.hasOwnProperty(feature)) {
                        if (this.features[feature]) {
                            link.classList.remove('hidden');
                        } else {
                            link.classList.add('hidden');
                        }
                    }
                });
            },
            
            // Initialize on page load
            init: function() {
                this.updateSidebar();
            }
        };
        
        // Initialize sidebar features
        document.addEventListener('DOMContentLoaded', function() {
            SidebarFeatures.init();
        });
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
